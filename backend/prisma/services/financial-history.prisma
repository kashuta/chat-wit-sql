generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/financial-history-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_FINANCIAL_HISTORY")
}

model FinancialTransaction {
  id            Int       @id @default(autoincrement())
  paymentTxId   String?   @unique
  walletTxId    Int?      @unique
  withdrawalId  Int?      @unique
  userId        Int
  type          FinType
  status        String
  amount        Int
  paymentMethod String
  campaignId    String?
  currency      String?
  createdAt     DateTime  @db.Timestamptz(3)
  updatedAt     DateTime  @db.Timestamptz(3)
  finishedAt    DateTime? @db.Timestamptz(3)
  externalId    String?
  paymentSystem String?
  providerName  String?
}

model StatusRule {
  id                 Int      @id @default(autoincrement())
  minDepositCount    Int?
  minDepositSum      Int?
  depositLogic       Logic?   @default(OR)
  minWithdrawalCount Int?
  minWithdrawalSum   Int?
  withdrawalLogic    Logic?   @default(OR)
  createdAt          DateTime @default(now()) @db.Timestamptz(3)
}

model User {
  id                    Int        @id @default(autoincrement())
  userId                Int        @unique
  depositCount          Int?       @default(0)
  depositSum            Int?       @default(0)
  withdrawalCount       Int?       @default(0)
  withdrawalSum         Int?       @default(0)
  isManualTrustedStatus Boolean    @default(false)
  trustedStatus         UserStatus @default(FTD)
  hasRefund             Boolean    @default(false)
  refundCount           Int        @default(0)
}

enum FinType {
  DEPOSIT
  WITHDRAWAL
  BONUS
  ADJUSTMENT
  GIFT
  PROMO_WIN
  CHARGE
  ROLLBACK
}

enum Logic {
  OR
  AND
}

enum UserStatus {
  FTD
  TRUSTED
}
